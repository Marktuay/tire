<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>Edit Address â€” GlobalTire</title>
		<meta name="description" content="Edit your billing or shipping address." />
        <link rel="stylesheet" href="css/style.css?v=1.2" />
        <link rel="stylesheet" href="css/footer.css?v=1.1" />
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;800&display=swap" rel="stylesheet">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
        <link rel="icon" type="image/png" sizes="32x32" href="https://www.globaltireservices.com/wp-content/uploads/2025/08/icon-32x32-1.png#5213">
	</head>
	<body class="theme-dark">
		<header class="site-header dark">
			<div class="container header-inner">
			   <a class="logo" href="index.html">
				   <img src="images/logo1.png" alt="GlobalTire logo" />
			   </a>
			<nav class="nav-desktop" aria-label="Main navigation">
				<a href="index.html">Home</a>
				<a href="about.html">About Us</a>
				<a href="automotive-services.html">Services</a>
				<a href="shop.html">Shop</a>
				<a href="contact.html" class="btn ghost">Contact Us</a>
			</nav>

			<div class="header-right">
				<div class="header-icons" aria-hidden="false">
					<a href="#" class="social" aria-label="Facebook" title="Facebook"><i class="bi bi-facebook" aria-hidden="true"></i></a>
					<a href="#" class="social" aria-label="Instagram" title="Instagram"><i class="bi bi-instagram" aria-hidden="true"></i></a>
					<a href="#" class="social" aria-label="LinkedIn" title="LinkedIn"><i class="bi bi-linkedin" aria-hidden="true"></i></a>
					</div>
					<button class="icon-btn" aria-label="Search">
						<i class="bi bi-search" aria-hidden="true"></i>
					</button>
					<a href="login.html" class="icon-btn" aria-label="Account">
						<i class="bi bi-person" aria-hidden="true"></i>
					</a>
					<a href="cart.html" class="icon-btn" aria-label="Cart" style="position: relative;">
						<i class="bi bi-cart" aria-hidden="true"></i>
					</a>
					<button class="menu-toggle" aria-expanded="false" aria-controls="main-navigation" aria-label="Open menu">
						<span class="hamburger">
							<span class="bar bar1"></span>
							<span class="bar bar2"></span>
							<span class="bar bar3"></span>
						</span>
					</button>
			</div>
			</div>
		</header>

		<main>
            <section class="section dark-section" style="padding-top: 120px; min-height: 80vh;">
                <div class="container">
                    <div class="dashboard-container" style="display: grid; grid-template-columns: 250px 1fr; gap: 40px;">
                        
                        <!-- Sidebar -->
                        <aside class="dashboard-sidebar">
                            <div class="user-brief" style="margin-bottom: 30px; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                <div style="width: 60px; height: 60px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold; color: #000; margin-bottom: 10px;">
                                    <span id="user-initials">U</span>
                                </div>
                                <h4 id="sidebar-username" style="margin: 0;">User</h4>
                                <p id="sidebar-email" style="opacity: 0.7; font-size: 0.9rem; margin: 5px 0 0;">...</p>
                            </div>

                            <nav class="dashboard-nav">
                                <ul style="list-style: none; padding: 0; margin: 0;">
                                    <li style="margin-bottom: 5px;">
                                        <a href="dashboard.html" class="dash-link" style="display: block; padding: 12px 15px; color: #fff; text-decoration: none; opacity: 0.8; transition: all 0.2s;">
                                            <i class="bi bi-speedometer2" style="margin-right: 10px;"></i> Dashboard
                                        </a>
                                        <ul style="list-style: none; padding: 5px 0 5px 20px; margin: 0;">
                                            <li style="margin-bottom: 5px;">
                                                <a href="orders.html" class="dash-link" style="display: block; padding: 8px 15px; color: #fff; text-decoration: none; opacity: 0.7; font-size: 0.95rem; transition: all 0.2s;">
                                                    <i class="bi bi-box-seam" style="margin-right: 10px;"></i> Orders
                                                </a>
                                            </li>
                                            <li style="margin-bottom: 5px;">
                                                <a href="addresses.html" class="dash-link active" style="display: block; padding: 8px 15px; background: var(--panel); border-radius: 6px; color: #000; text-decoration: none; font-weight: 600;">
                                                    <i class="bi bi-geo-alt" style="margin-right: 10px;"></i> Addresses
                                                </a>
                                            </li>
                                            <li style="margin-bottom: 5px;">
                                                <a href="account-details.html" class="dash-link" style="display: block; padding: 8px 15px; color: #fff; text-decoration: none; opacity: 0.7; font-size: 0.95rem; transition: all 0.2s;">
                                                    <i class="bi bi-person-gear" style="margin-right: 10px;"></i> Account Details
                                                </a>
                                            </li>
                                        </ul>
                                    </li>
                                    <li>
                                        <a href="#" id="dash-logout" style="display: block; padding: 12px 15px; color: #ff6b6b; text-decoration: none; transition: all 0.2s; margin-top: 10px;">
                                            <i class="bi bi-box-arrow-left" style="margin-right: 10px;"></i> Logout
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </aside>

                        <!-- Content Area -->
                        <div class="dashboard-content">
                            <h2 id="edit-title" style="margin-bottom: 20px;">Edit Address</h2>
                            <div id="msg" style="display:none; margin-bottom: 20px; padding: 15px; border-radius: 6px;"></div>

                            <form id="address-form" class="auth-form" style="max-width: 600px;">
                                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                                    <div class="form-group">
                                        <label>First Name *</label>
                                        <input type="text" name="first_name" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Last Name *</label>
                                        <input type="text" name="last_name" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Company (optional)</label>
                                    <input type="text" name="company">
                                </div>
                                <div class="form-group">
                                    <label>Street Address *</label>
                                    <input type="text" name="address_1" placeholder="House number and street name" required style="margin-bottom: 10px;">
                                    <input type="text" name="address_2" placeholder="Apartment, suite, unit, etc. (optional)">
                                </div>
                                <div class="form-group">
                                    <label>Town / City *</label>
                                    <input type="text" name="city" required>
                                </div>
                                <div class="form-group">
                                    <label>State *</label>
                                    <input type="text" name="state" required>
                                </div>
                                <div class="form-group">
                                    <label>Postcode / ZIP *</label>
                                    <input type="text" name="postcode" required>
                                </div>
                                <div class="form-group">
                                    <label>Phone *</label>
                                    <input type="tel" name="phone" required>
                                </div>
                                <div class="form-group">
                                    <label>Email Address *</label>
                                    <input type="email" name="email" required>
                                </div>
                                <button type="submit" class="btn primary">Save Address</button>
                                <a href="addresses.html" class="btn ghost" style="margin-left: 10px;">Cancel</a>
                            </form>
                        </div>
                    </div>
                </div>
            </section>
		</main>

		<footer id="contacto" class="site-footer dark-footer"></footer>

        <script src="js/cart.js?v=1.2"></script>
    <script src="js/footer.js?v=1.1" defer></script>
        <script src="js/main.js" defer></script>
        <script src="js/auth.js?v=1.1"></script>
        <script>
            document.addEventListener('DOMContentLoaded', async () => {
                const userStr = localStorage.getItem('gt_user');
                if (!userStr) { window.location.href = 'login.html'; return; }
                const user = JSON.parse(userStr);
                
                const urlParams = new URLSearchParams(window.location.search);
                const type = urlParams.get('type') || 'billing';
                document.getElementById('edit-title').innerText = `Edit ${type.charAt(0).toUpperCase() + type.slice(1)} Address`;

                // Load existing data
                try {
                    const resp = await fetch(`https://www.globaltireservices.com/auth-proxy.php?action=get_address&user_id=${user.id}`, {
                        credentials: 'include'
                    });
                    const data = await resp.json();
                    if (data.success) {
                        const addr = data[type];
                        const form = document.getElementById('address-form');
                        for (let key in addr) {
                            if (form.elements[key]) form.elements[key].value = addr[key];
                        }
                    }
                } catch(e) { console.error(e); }

                // Sidebar & Logout (omitted for brevity in template, but same as others)
                document.getElementById('sidebar-username').innerText = user.display_name || user.username;
                document.getElementById('sidebar-email').innerText = user.email;
                if (user.avatar_url) {
                    const avatarContainer = document.getElementById('user-initials').parentElement;
                    avatarContainer.style.background = 'transparent';
                    avatarContainer.innerHTML = `<img src="${user.avatar_url}" alt="Avatar" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
                }

                document.getElementById('address-form').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    const data = Object.fromEntries(formData.entries());
                    const msg = document.getElementById('msg');
                    
                    try {
                        const resp = await fetch('https://www.globaltireservices.com/auth-proxy.php?action=update_address', {
                            method: 'POST',
                            credentials: 'include',
                            body: JSON.stringify({
                                user_id: user.id,
                                type: type,
                                address: data
                            })
                        });
                        const res = await resp.json();
                        if (res.success) {
                            msg.style.display = 'block';
                            msg.style.background = '#d4edda';
                            msg.style.color = '#155724';
                            msg.innerText = 'Address updated successfully!';
                            setTimeout(() => window.location.href = 'addresses.html', 1500);
                        } else {
                            msg.style.display = 'block';
                            msg.style.background = '#f8d7da';
                            msg.style.color = '#721c24';
                            msg.innerText = res.message || 'Error updating address.';
                        }
                    } catch(err) {
                        console.error(err);
                    }
                });
            });
        </script>
</body>
</html>
